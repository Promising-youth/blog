概述
====

某天，朋友问我关于https的事，突然就蒙蔽了，只是知道https是加密，但是怎么加密的却不知道。于是上网开始好好补补功课。

加密的方法
==========

-   对称加密: 两个公钥。
-   非对称加密:
    一个公钥，一个私钥。一般来说服务端保存私钥，客户端使用公钥。
-   不可逆加密: hash/md5等。

https协议则是对称加密和非对称加密的结合体。为什么不单独使用非对称加密，原因是非对称加密效率感人。另外一点是，非对称加密对于服务端往客户端传数据时，并不是安全的，原因在于公钥对所有人可见，黑客也可以拦截服务端的消息来解密。

https的流程:

其中:

简称|解释
-|-
c端| client端，客户端
s端| server，服务端

步骤| 客户端 | 服务端| 问题
-|-|-|-
1 | c端请求s端，并向s端发送随机数a以及支持的协议版本及加密算法 | s端确认协议及加密算法，并向c发送证书以及随机数b。c端在本地进行证书的校验|证书的作用是什么?证书能否被劫持并替换?
2 | 校验证书，并获取证书中对应的公钥。||为什么通过证书获取公钥，而不是服务器下发呢?
3 | 生成随机数secret，通过公钥加密后发送给服务端 | 服务端用随机数a,b和secret来生成对称密钥，客户端用同样的手端生成对称密钥，后续的所有的通信都通过该对称密钥通信。| 

// 另外一些版本的第3，4，5步是这样的，可做参考

步骤| 客户端 | 服务端| 问题
-|-|-|-
3| 确认服务器身份，向服务端发送随机串 | 服务端通过hash算法后再通过私钥加密，返回给客户端，客户端通过公钥解密并做校验| 。问:为什么要先hash一遍
4 | 客户端生成对称加密密钥，通过公钥对该对称加密密钥进行加密发送给服务端，告知服务端，后续都通过该对称密钥通信。| 服务端使用私钥解密获取对称密钥。|
5 | ...|...|...

问题解决
========

1.  证书的作用是什么?
 > 证书主要是携带后续通信的公钥以及颁发机构等信息，用于让前端校验该证书的合法性并获取到相关的公钥信息。
2.  证书能否被劫持并替换?
>客户端在获取证书时，会通过数字签名校验证书是否被修改，再通过证书中的ca与本地进行对比，来校验证书的合法性。
| 证书机构一般会对证书进行私钥加密，而os里一般都会内置知名证书机构的公钥，使用该公钥进行解密并做校验(证书的签名)，基本上证书不会被劫持并替换。
3.  为什么通过证书获取公钥，而不是服务器下发。
> 若服务器下发公钥，则黑客同样可下发公钥来以假乱真。
4. 为什么先hash一遍?
> 防止黑客频繁发送简单串来破解私钥。
